<div class="modal-overlay">
  <div class="modal-container">
    <div class="modal-header">
      <div>
        <h2>{{ user ? 'Editar Perfil' : 'Crear Nuevo Usuario' }}</h2>
        <p class="subtitle">Complete la información del colaborador</p>
      </div>
      <button class="btn-close" (click)="close.emit()">
        <i-feather name="x"></i-feather>
      </button>
    </div>

    <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="modal-body">
      
      <div class="form-section">
        <h3><i-feather name="user" class="section-icon"></i-feather> Información Personal</h3>
        
        <div class="grid-2">
          <div class="form-group">
            <label>Nombre Completo</label>
            <div class="input-wrapper">
              <i-feather name="user" class="input-icon"></i-feather>
              <input type="text" formControlName="fullName" placeholder="Ej. Pepito Pérez">
            </div>
          </div>
          <div class="form-group">
            <label>Correo Electrónico</label>
            <div class="input-wrapper">
              <i-feather name="mail" class="input-icon"></i-feather>
              <input type="email" formControlName="email" placeholder="usuario@empresa.com">
            </div>
          </div>
        </div>
        
        <div class="form-group">
          <label>Contraseña {{ user ? '(Opcional)' : '*' }}</label>
          <div class="input-wrapper">
            <i-feather name="lock" class="input-icon"></i-feather>
            <input type="password" formControlName="password" placeholder="••••••••">
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3><i-feather name="briefcase" class="section-icon"></i-feather> Datos Laborales</h3>
        
        <div class="grid-3">
          <div class="form-group">
            <label>Tipo Doc.</label>
            <div class="select-wrapper">
              <select formControlName="documentType">
                <option value="CC">CC - Cédula</option>
                <option value="CE">CE - Extranjería</option>
                <option value="PP">PP - Pasaporte</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label>No. Documento</label>
            <div class="input-wrapper">
              <i-feather name="credit-card" class="input-icon"></i-feather>
              <input type="text" formControlName="documentNumber" placeholder="123456789">
            </div>
          </div>
          <div class="form-group">
            <label>Fecha Ingreso</label>
            <div class="input-wrapper">
              <i-feather name="calendar" class="input-icon"></i-feather>
              <input type="date" formControlName="hiringDate">
            </div>
          </div>
        </div>
      </div>

      <div class="form-section">
        <h3><i-feather name="shield" class="section-icon"></i-feather> Permisos</h3>
        
        <div class="grid-2">
          <div class="form-group">
            <label>Rol de Usuario</label>
            <div class="select-wrapper">
              <select formControlName="role">
                @for (role of availableRoles; track role) {
                  <option [value]="role">{{ role }}</option>
                }
              </select>
            </div>
          </div>

          @if (isOwner) {
            <div class="form-group">
              <label>Sede Asignada</label>
              <div class="select-wrapper">
                <select formControlName="branchId">
                  <option value="" disabled>Seleccione una sede</option>
                  @for (branch of branches(); track branch._id) {
                    <option [value]="branch._id">{{ branch.name }}</option>
                  }
                </select>
              </div>
            </div>
          }
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-cancel" (click)="close.emit()">Cancelar</button>
        <button type="submit" class="btn-save" [disabled]="isLoading || userForm.invalid">
          {{ isLoading ? 'Guardando...' : 'Guardar Usuario' }}
        </button>
      </div>

    </form>
  </div>
</div>